# Auto-Builder 제품 요구사항 문서 (PRD)

> Product Requirements Document
>
> 버전: 1.0
> 작성일: 2026-01-12
> 상태: Draft

---

## 1. 개요 (Executive Summary)

### 1.1 제품 정의

**Auto-Builder**는 AI 기반의 자동화된 Java 마이그레이션 및 빌드 시스템입니다. 레거시 Java 프로젝트(Java 8, Spring Boot 2)를 최신 버전(Java 17, Spring Boot 3)으로 자동 변환하고, LLM을 활용하여 빌드 에러를 자동으로 수정합니다.

### 1.2 비전

> "개발자가 수작업으로 수행하던 수일~수주의 마이그레이션 작업을 **수시간 내에 자동화**하여 완료"

### 1.3 핵심 가치

| 가치 | 설명 |
|------|------|
| **자동화** | OpenRewrite + LLM으로 코드 변환 및 에러 수정 자동화 |
| **일관성** | 표준화된 마이그레이션 파이프라인으로 품질 균일화 |
| 효율성 | 반복적인 수작업을 제거하여 개발자 생산성 향상 |
| **추적성** | 모든 변환 과정을 단계별로 기록하여 감사 가능 |

---

## 2. 문제 정의 (Problem Statement)

### 2.1 현재 상황

기업 내 레거시 Java 애플리케이션들이 다음과 같은 문제에 직면:

1. **기술 부채 누적**: Java 8, Spring Boot 2 기반 시스템이 지원 종료(EOL)에 도달
2. **보안 취약점**: 구버전 프레임워크의 알려진 보안 취약점 노출
3. **유지보수 비용**: 레거시 코드 유지보수에 많은 인력/시간 소요
4. **인력 부족**: 마이그레이션 경험이 있는 숙련된 개발자 부족

### 2.2 기존 마이그레이션 방식의 한계

| 문제 | 설명 |
|------|------|
| **수작업 의존** | 개발자가 직접 코드 수정, 에러 해결 |
| **긴 소요 시간** | 프로젝트당 수일~수주 소요 |
| **일관성 부재** | 개발자마다 다른 방식으로 수정 |
| **지식 손실** | 마이그레이션 경험이 문서화되지 않음 |
| **반복 작업** | 유사한 에러 패턴을 매번 수동 해결 |

### 2.3 해결해야 할 핵심 문제

> "Java 8 → 17, Spring Boot 2 → 3 마이그레이션을 **자동화**하고, 발생하는 빌드 에러를 **LLM으로 자동 수정**"

---

## 3. 목표 (Goals & Objectives)

### 3.1 비즈니스 목표

| 목표 | 측정 지표 |
|------|----------|
| 마이그레이션 소요 시간 단축 | 기존 대비 80% 이상 감소 |
| 개발자 투입 시간 절감 | 프로젝트당 평균 3일 → 2시간 |
| 마이그레이션 성공률 | 90% 이상 자동 완료 |
| 반복 사용률 | 월 활성 프로젝트 수 증가 |

### 3.2 제품 목표

1. **자동화된 코드 변환**: OpenRewrite 레시피를 통한 Java/Spring 버전 업그레이드
2. **지능형 에러 수정**: LLM 기반 빌드 에러 분석 및 자동 수정
3. **시각적 실행 모니터링**: 실시간 진행 상황 확인 및 로그 추적
4. **학습 데이터 축적**: 에러 수정 패턴을 Few-shot 데이터로 저장

### 3.3 사용자 목표

- 비숙련 개발자도 마이그레이션 수행 가능
- 마이그레이션 과정의 투명한 가시성 확보
- 실패 시 원인 파악 및 수동 개입 지점 명확화

---

## 4. 타겟 사용자 (Target Users)

### 4.1 주요 사용자 페르소나

#### 페르소나 1: 주니어 개발자 (김개발)
| 항목 | 설명 |
|------|------|
| 역할 | 신입~3년차 Java 개발자 |
| 배경 | Spring Boot는 경험 있으나 마이그레이션 경험 없음 |
| 고민 | 레거시 코드 마이그레이션 방법을 모름 |
| 기대 | 버튼 클릭으로 자동 마이그레이션 |

#### 페르소나 2: 시니어 개발자 (박시니어)
| 항목 | 설명 |
|------|------|
| 역할 | 5년차 이상 Java 아키텍트 |
| 배경 | 다수의 마이그레이션 경험 보유 |
| 고민 | 반복적인 작업에 시간 낭비 |
| 기대 | 자동화로 고부가가치 업무에 집중 |

#### 페르소나 3: 팀 리더 (이리더)
| 항목 | 설명 |
|------|------|
| 역할 | 개발팀 리더, 프로젝트 관리자 |
| 배경 | 다수의 레거시 시스템 관리 책임 |
| 고민 | 마이그레이션 일정 및 리소스 관리 |
| 기대 | 진행 현황 대시보드, 성공률 통계 |

### 4.2 사용자 Journey

```
1. 프로젝트 등록
   └─ Git URL 또는 ZIP 파일 업로드

2. 마이그레이션 설정
   └─ 타겟 버전, 빌드 도구, 옵션 선택

3. 실행 시작
   └─ 워크플로우 실행 버튼 클릭

4. 진행 모니터링
   └─ 실시간 단계별 상태/로그 확인

5. 결과 확인
   └─ 변환된 코드 다운로드 또는 Git push
```

---

## 5. 기능 요구사항 (Functional Requirements)

### 5.1 핵심 기능 (Must Have)

#### F1: 프로젝트 관리
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F1.1 | 프로젝트 생성 | Git URL 또는 ZIP 업로드로 프로젝트 등록 | P0 |
| F1.2 | 프로젝트 설정 | 타겟 Java/Spring 버전, 빌드 도구 설정 | P0 |
| F1.3 | 프로젝트 목록 | 등록된 프로젝트 조회/검색/필터 | P0 |
| F1.4 | 그룹 관리 | 프로젝트 그룹화 및 권한 관리 | P1 |

#### F2: 마이그레이션 실행
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F2.1 | 워크플로우 실행 | 설정된 단계(Step) 순차 실행 | P0 |
| F2.2 | OpenRewrite 적용 | Java/Spring 버전 업그레이드 레시피 실행 | P0 |
| F2.3 | LLM 빌드 수정 | 빌드 에러 분석 및 자동 코드 수정 | P0 |
| F2.4 | 반복 빌드 | 에러 수정 후 재빌드 (최대 N회 반복) | P0 |

#### F3: 실행 모니터링
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F3.1 | 실시간 상태 | 각 단계별 진행 상태 실시간 표시 | P0 |
| F3.2 | 로그 스트리밍 | SSE 기반 실시간 로그 출력 | P0 |
| F3.3 | 시각적 플로우 | ReactFlow 기반 실행 단계 시각화 | P1 |
| F3.4 | 실행 이력 | 과거 실행 내역 조회 및 비교 | P1 |

#### F4: 결과 관리
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F4.1 | 변환 코드 다운로드 | 마이그레이션된 소스 ZIP 다운로드 | P0 |
| F4.2 | 변경 내역 조회 | 수정된 파일 목록 및 diff 확인 | P1 |
| F4.3 | 에러 리포트 | 실패 시 에러 원인 상세 리포트 | P0 |

### 5.2 부가 기능 (Nice to Have)

#### F5: AI 프롬프트 관리
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F5.1 | 프롬프트 템플릿 | LLM 프롬프트 커스터마이징 | P2 |
| F5.2 | Few-shot 관리 | 에러 수정 예시 데이터 관리 | P2 |
| F5.3 | 태그 시스템 | 프롬프트/프로젝트 분류 태그 | P2 |

#### F6: 관리자 기능
| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F6.1 | 대시보드 | 전체 실행 통계, 성공률 차트 | P1 |
| F6.2 | 사용자 관리 | 사용자 등록/권한 관리 | P1 |
| F6.3 | 그룹 권한 | 그룹별 접근 권한 설정 | P2 |

### 5.3 마이그레이션 파이프라인 단계

```
┌──────────────────────────────────────────────────────────────────┐
│                    마이그레이션 파이프라인                         │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [Step 0]        [Step 1]         [Step 2]        [Step 3]       │
│  SETUP_PROJECT → OPENREWRITE  →   SQL        →   BUILD_LLM      │
│                                                                  │
│  ┌──────────┐   ┌──────────────┐  ┌─────────┐   ┌─────────────┐  │
│  │Git Clone │   │ Java 8→17   │  │ SQL문법 │   │ Maven/Gradle│  │
│  │  또는    │ → │ Spring 2→3  │→ │  변환   │ → │   빌드      │  │
│  │ZIP 압축해제│   │ (OpenRewrite)│  │         │   │ + LLM 수정  │  │
│  └──────────┘   └──────────────┘  └─────────┘   └─────────────┘  │
│                                                                  │
│                                        ↓ (빌드 실패시)            │
│                                   ┌─────────────┐                │
│                                   │ LLM 에러분석│                │
│                                   │ 코드 수정   │                │
│                                   │ 재빌드 반복 │                │
│                                   └─────────────┘                │
└──────────────────────────────────────────────────────────────────┘
```

---

## 6. 기술 아키텍처 (Technical Architecture)

### 6.1 시스템 구성

```
┌─────────────────────────────────────────────────────────────────────┐
│                           Client Layer                              │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                    Auto-Builder UI                            │  │
│  │                   (Next.js 15, React 19)                      │  │
│  └───────────────────────────────────────────────────────────────┘  │
└────────────────────────────────┬────────────────────────────────────┘
                                 │ HTTPS
┌────────────────────────────────▼────────────────────────────────────┐
│                         Kubernetes (AKS)                            │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      NGINX Ingress                          │    │
│  └─────────────────────────────────────────────────────────────┘    │
│            │                    │                    │              │
│            ▼                    ▼                    ▼              │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐          │
│  │  cms-web-ui  │    │ cms-web-api  │    │ cms-web-mcp  │          │
│  │  (Next.js)   │    │  (FastAPI)   │    │  (MCP Server)│          │
│  └──────────────┘    └──────────────┘    └──────────────┘          │
│                              │                                      │
│                              ▼                                      │
│                    ┌──────────────────┐                            │
│                    │  Celery Worker   │                            │
│                    │ (비동기 작업 실행) │                            │
│                    └────────┬─────────┘                            │
│                             │                                      │
│            ┌────────────────┼────────────────┐                     │
│            ▼                ▼                ▼                     │
│    ┌────────────┐   ┌────────────┐   ┌─────────────────┐          │
│    │   Redis    │   │ K8s Jobs   │   │ Azure Files PVC │          │
│    │ (Queue/Cache)│   │ (빌드 컨테이너)│   │ (프로젝트 데이터)│          │
│    └────────────┘   └────────────┘   └─────────────────┘          │
└─────────────────────────────────────────────────────────────────────┘
                                 │
┌────────────────────────────────▼────────────────────────────────────┐
│                        External Services                            │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐          │
│  │  PostgreSQL  │    │     ACR      │    │  OpenAI/     │          │
│  │   (Azure)    │    │ (이미지 레지스트리)│    │  Claude API  │          │
│  └──────────────┘    └──────────────┘    └──────────────┘          │
└─────────────────────────────────────────────────────────────────────┘
```

### 6.2 기술 스택

#### Backend
| 구성요소 | 기술 | 버전 |
|----------|------|------|
| Framework | FastAPI | 0.100+ |
| Language | Python | 3.12 |
| Task Queue | Celery | 5.x |
| Message Broker | Redis | 7.x |
| Database | PostgreSQL | 15+ |
| Container Runtime | Kubernetes (AKS) | 1.28+ |

#### Frontend
| 구성요소 | 기술 | 버전 |
|----------|------|------|
| Framework | Next.js | 15.x |
| Library | React | 19 |
| Styling | SCSS | - |
| Visualization | ReactFlow, Chart.js | - |
| Code Editor | CodeMirror | 6.x |

#### Infrastructure
| 구성요소 | 서비스 |
|----------|--------|
| Container Orchestration | Azure Kubernetes Service (AKS) |
| Container Registry | Azure Container Registry (ACR) |
| Database | Azure Database for PostgreSQL |
| Storage | Azure Files (Premium) |
| Secrets | Azure Key Vault |
| CI/CD | GitHub Actions |

### 6.3 데이터 모델 (Core Entities)

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│    Group     │────<│   Project    │────<│     Run      │
├──────────────┤     ├──────────────┤     ├──────────────┤
│ id           │     │ id           │     │ id           │
│ name         │     │ group_id     │     │ project_id   │
│ description  │     │ name         │     │ status       │
│ created_at   │     │ source_type  │     │ started_at   │
│              │     │ git_url      │     │ completed_at │
│              │     │ build_tool   │     │ error_message│
│              │     │ java_version │     │              │
│              │     │ spring_version│    │              │
└──────────────┘     └──────────────┘     └──────┬───────┘
                                                  │
                                                  │
                                          ┌──────▼───────┐
                                          │   RunStep    │
                                          ├──────────────┤
                                          │ id           │
                                          │ run_id       │
                                          │ step_type    │
                                          │ status       │
                                          │ started_at   │
                                          │ completed_at │
                                          │ log_output   │
                                          └──────────────┘
```

---

## 7. 비기능 요구사항 (Non-Functional Requirements)

### 7.1 성능 (Performance)

| 항목 | 요구사항 |
|------|----------|
| API 응답 시간 | < 500ms (95 percentile) |
| 동시 실행 프로젝트 | 최대 10개 |
| 단일 프로젝트 처리 시간 | < 30분 (중형 프로젝트 기준) |
| 로그 스트리밍 지연 | < 1초 |

### 7.2 확장성 (Scalability)

| 항목 | 요구사항 |
|------|----------|
| Horizontal Scaling | HPA 기반 Pod 자동 확장 (1-5 replicas) |
| 스토리지 | Azure Files Premium 100GiB (확장 가능) |
| 빌드 Job | 동시 최대 5개 K8s Job 실행 |

### 7.3 가용성 (Availability)

| 항목 | 요구사항 |
|------|----------|
| 서비스 가용성 | 99.5% 이상 |
| 계획된 다운타임 | 월 1회, 30분 이내 |
| 무중단 배포 | Rolling Update 적용 |
| PDB | 최소 1개 Pod 항상 가동 |

### 7.4 보안 (Security)

| 항목 | 요구사항 |
|------|----------|
| 인증 | NextAuth (JWT 기반) |
| 시크릿 관리 | Azure Key Vault |
| 네트워크 | AKS 내부 통신, Ingress 통한 외부 노출 |
| 이미지 보안 | ACR 프라이빗 레지스트리 사용 |
| DB 접근 | SSL 필수, AKS 서브넷에서만 접근 허용 |

### 7.5 모니터링 (Observability)

| 항목 | 요구사항 |
|------|----------|
| 로깅 | 구조화된 JSON 로그 |
| 메트릭 | Prometheus 형식 메트릭 노출 |
| 트레이싱 | 요청 ID 기반 추적 |
| 알림 | 실행 실패 시 알림 (Slack/Email) |

---

## 8. API 명세 (API Specification)

### 8.1 주요 엔드포인트

#### 프로젝트 API
```
POST   /api/v1/tr/projects                 # 프로젝트 생성
GET    /api/v1/tr/projects                 # 프로젝트 목록 조회
GET    /api/v1/tr/projects/{id}            # 프로젝트 상세 조회
PUT    /api/v1/tr/projects/{id}            # 프로젝트 수정
DELETE /api/v1/tr/projects/{id}            # 프로젝트 삭제
POST   /api/v1/tr/projects/{id}/upload     # 소스 업로드
```

#### 실행 API
```
POST   /api/v1/tr/projects/{id}/runs       # 실행 시작
GET    /api/v1/tr/runs                     # 실행 목록 조회
GET    /api/v1/tr/runs/{id}                # 실행 상세 조회
GET    /api/v1/tr/runs/{id}/logs           # 로그 조회 (SSE)
POST   /api/v1/tr/runs/{id}/cancel         # 실행 취소
```

#### MCP API
```
POST   /mcp/v1/tools/call                  # MCP 도구 호출
GET    /mcp/v1/tools/list                  # 사용 가능한 도구 목록
```

### 8.2 응답 형식

```json
{
  "code": "0000",
  "message": "Success",
  "data": {
    "result": [...],
    "pagination": {
      "page": 0,
      "size": 10,
      "total": 100
    }
  }
}
```

---

## 9. 사용자 인터페이스 (UI/UX)

### 9.1 주요 화면

| 화면 | 설명 | 주요 기능 |
|------|------|----------|
| 대시보드 | 메인 화면 | 통계, 최근 실행, 활성 프로젝트 |
| 프로젝트 관리 | 프로젝트 CRUD | 목록, 상세, 등록, 수정 |
| 실행 관리 | 워크플로우 실행 | 실행, 모니터링, 로그 |
| 설정 | 시스템 설정 | 그룹, 태그, 프롬프트 관리 |

### 9.2 실행 화면 와이어프레임

```
┌─────────────────────────────────────────────────────────────────┐
│  [프로젝트 선택 ▼]                              [실행] [중지]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   실행 플로우 시각화                      │    │
│  │                                                         │    │
│  │   [SETUP]──→[REWRITE]──→[SQL]──→[BUILD_LLM]            │    │
│  │      ✓         ●         ○          ○                   │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  버전 목록              │  실시간 로그                          │
│  ┌───────────────────┐  │  ┌─────────────────────────────────┐  │
│  │ v1 - 완료 ✓       │  │  │ [12:00:01] Step 1 started...    │  │
│  │ v2 - 실행중 ●     │  │  │ [12:00:02] Applying recipe...   │  │
│  │ v3 - 대기 ○       │  │  │ [12:00:15] Build started...     │  │
│  └───────────────────┘  │  │ [12:00:45] Error: NullPointer...│  │
│                         │  │ [12:00:46] LLM fixing...         │  │
│                         │  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 10. 성공 지표 (Success Metrics)

### 10.1 핵심 성과 지표 (KPIs)

| 지표 | 정의 | 목표 |
|------|------|------|
| **마이그레이션 성공률** | 자동 완료된 프로젝트 / 전체 실행 | > 90% |
| **평균 처리 시간** | 실행 시작 ~ 완료 시간 | < 15분 |
| **LLM 수정 성공률** | 자동 수정으로 빌드 성공 / 빌드 실패 | > 80% |
| **사용자 만족도** | 설문 조사 결과 | > 4.0/5.0 |

### 10.2 운영 지표

| 지표 | 정의 | 목표 |
|------|------|------|
| 일 평균 실행 수 | 하루 동안 실행된 마이그레이션 수 | 모니터링 |
| 월 활성 사용자 | 한 달간 1회 이상 실행한 사용자 | 증가 추세 |
| 평균 반복 빌드 횟수 | BUILD_LLM 단계 평균 반복 수 | < 3회 |
| 시스템 가용성 | 서비스 정상 시간 / 전체 시간 | > 99.5% |

---

## 11. 의존성 및 제약사항 (Dependencies & Constraints)

### 11.1 외부 의존성

| 의존성 | 설명 | 위험도 |
|--------|------|:------:|
| OpenAI API | LLM 에러 분석/수정 | 높음 |
| Claude API | 대체 LLM 옵션 | 중간 |
| Azure Services | 인프라 (AKS, PostgreSQL, ACR) | 높음 |
| GitHub | 소스 코드 연동, CI/CD | 중간 |
| Azure DevOps Artifacts | 사내 의존성 저장소 | 높음 |

### 11.2 제약사항

| 제약 | 설명 |
|------|------|
| 네트워크 | 사내망 또는 VPN 필요 (Azure DevOps Artifacts 접근) |
| 빌드 도구 | Maven/Gradle만 지원 (Ant 미지원) |
| Java 버전 | Java 8 → 11/17만 지원 |
| Spring 버전 | Spring Boot 2.x → 3.x만 지원 |
| 프로젝트 크기 | 최대 1GB 소스 코드 |

---

## 12. 릴리즈 계획 (Release Plan)

### 12.1 Phase 1: MVP (Minimum Viable Product)

**범위:**
- AKS 전환 

### 12.2 Phase 2: Enhanced Features

**범위:**
- 성능 테스트 및 가용성 확보 

### 12.3 Phase 3: Advanced Capabilities

**범위:**
- TBD

---

## 13. 리스크 및 완화 방안 (Risks & Mitigations)

| 리스크 | 영향 | 가능성 | 완화 방안 |
|--------|:----:|:------:|----------|
| LLM API 장애 | 높음 | 낮음 | 다중 LLM 제공자 지원 (OpenAI, Claude) |
| 빌드 시간 초과 | 중간 | 중간 | Job 타임아웃 설정, 리소스 상향 |
| 대용량 프로젝트 | 중간 | 중간 | 파일 크기 제한, 청크 처리 |
| Azure 서비스 장애 | 높음 | 낮음 | 모니터링 강화, 알림 설정 |
| 복잡한 레거시 코드 | 높음 | 높음 | 수동 개입 가이드 제공, Few-shot 축적 |

---

## 14. 용어 정의 (Glossary)

| 용어 | 정의 |
|------|------|
| **OpenRewrite** | 코드 자동 리팩토링 도구 (레시피 기반) |
| **LLM** | Large Language Model (GPT, Claude 등) |
| **Few-shot** | LLM에 제공하는 예시 데이터 |
| **MCP** | Model Context Protocol (AI 도구 표준) |
| **Run** | 마이그레이션 실행 단위 |
| **Step** | 실행 내 개별 작업 단계 |
| **TR** | Transformation (코드 변환) |

---

## 15. 부록 (Appendix)

### 15.1 관련 문서

- [[설계] azure-infra-resources-v2](./[설계]%20azure-infra-resources-v2.md)
- [신규환경-배포-체크리스트-v2](./신규환경-배포-체크리스트-v2.md)
- [유즈케이스-Java8to17-실행흐름](./유즈케이스-Java8to17-실행흐름.md)
- [환경별-설정-현황](./환경별-설정-현황.md)

### 15.2 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-12 | - | 초안 작성 |

---

*문서 작성일: 2026-01-12*
