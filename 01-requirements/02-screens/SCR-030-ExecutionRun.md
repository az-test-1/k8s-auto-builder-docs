# SCR-030: 실행 화면

> **Status**: Draft
> **Version**: 1.0.0
> **Last Updated**: 2026-01-13
> **Parent**: [PRD-010-Core-Migration](../01-prd/PRD-010-Core-Migration.md)

---

## 1. 개요

### 1.1 화면 정보
| 항목 | 내용 |
|------|------|
| 화면 ID | SCR-030 |
| 화면명 | 실행 화면 |
| URL | `/runs/new?projectId={id}` |
| 접근 권한 | USER, ADMIN |

### 1.2 목적
마이그레이션 워크플로우를 실행하고 실시간으로 진행 상황을 모니터링합니다.

---

## 2. 화면 구성

### 2.1 와이어프레임 (실행 전)

```
┌─────────────────────────────────────────────────────────────────┐
│ 마이그레이션 실행                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 프로젝트 선택                                            │    │
│  │ ┌─────────────────────────────────────────────────────┐ │    │
│  │ │ my-legacy-project                                 ▼ │ │    │
│  │ └─────────────────────────────────────────────────────┘ │    │
│  │                                                         │    │
│  │ 📋 프로젝트 정보                                         │    │
│  │ ┌─────────────────────────────────────────────────────┐ │    │
│  │ │ Java: 8 → 17  │  Spring: 2.x → 3.2  │  Maven       │ │    │
│  │ │ 소스: Git (github.com/org/repo)                    │ │    │
│  │ └─────────────────────────────────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ ⚙️ 실행 옵션                                             │    │
│  │                                                         │    │
│  │ 실행 단계 선택                                           │    │
│  │ ☑ Step 0: 프로젝트 설정 (SETUP_PROJECT)                 │    │
│  │ ☑ Step 1: OpenRewrite 변환 (OPENREWRITE)               │    │
│  │ ☑ Step 2: SQL 변환 (SQL)                               │    │
│  │ ☑ Step 3: 빌드 및 LLM 수정 (BUILD_LLM)                  │    │
│  │                                                         │    │
│  │ LLM 설정                                                │    │
│  │ ┌─────────────────────────────────────────────────┐     │    │
│  │ │ GPT-4o                                        ▼ │     │    │
│  │ └─────────────────────────────────────────────────┘     │    │
│  │                                                         │    │
│  │ 최대 빌드 반복 횟수                                      │    │
│  │ ┌─────────────────────────────────────────────────┐     │    │
│  │ │ 5                                             ▼ │     │    │
│  │ └─────────────────────────────────────────────────┘     │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                              [취소]   [▶️ 실행 시작]      │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 와이어프레임 (실행 중)

```
┌─────────────────────────────────────────────────────────────────┐
│ 마이그레이션 실행                              [⏹️ 중지] [📋 복사]│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📁 my-legacy-project                    Run #26         │    │
│  │ 상태: 실행 중  │  경과 시간: 03:25                       │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   워크플로우 시각화                       │    │
│  │                                                         │    │
│  │   ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐  │    │
│  │   │ SETUP  │───→│REWRITE │───→│  SQL   │───→│ BUILD  │  │    │
│  │   │   ✓    │    │   ✓    │    │   ●    │    │   ○    │  │    │
│  │   │ 0:32   │    │ 1:45   │    │ 1:08   │    │  -     │  │    │
│  │   └────────┘    └────────┘    └────────┘    └────────┘  │    │
│  │                                                         │    │
│  │   ✓ 완료   ● 진행중   ○ 대기   ✗ 실패                   │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📜 실시간 로그                              [Auto-scroll]│    │
│  │ ┌─────────────────────────────────────────────────────┐ │    │
│  │ │ [03:20] SQL 변환 시작...                            │ │    │
│  │ │ [03:21] 파일 분석 중: src/main/resources/mapper/    │ │    │
│  │ │ [03:22] 발견된 SQL 파일: 15개                       │ │    │
│  │ │ [03:23] SQL 변환 적용 중...                         │ │    │
│  │ │ [03:24] 변환 완료: UserMapper.xml                   │ │    │
│  │ │ [03:25] 변환 완료: OrderMapper.xml                  │ │    │
│  │ │ ●                                                   │ │    │
│  │ └─────────────────────────────────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 와이어프레임 (BUILD_LLM 단계)

```
┌─────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   워크플로우 시각화                       │    │
│  │                                                         │    │
│  │   ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐  │    │
│  │   │ SETUP  │───→│REWRITE │───→│  SQL   │───→│ BUILD  │  │    │
│  │   │   ✓    │    │   ✓    │    │   ✓    │    │   ●    │  │    │
│  │   └────────┘    └────────┘    └────────┘    └────────┘  │    │
│  │                                                  │       │    │
│  │                                                  ▼       │    │
│  │                                          ┌─────────────┐ │    │
│  │                                          │ BUILD_LLM   │ │    │
│  │                                          │ 반복: 2/5   │ │    │
│  │                                          │             │ │    │
│  │                                          │ ┌─────────┐ │ │    │
│  │                                          │ │ 빌드    │ │ │    │
│  │                                          │ │   ✗     │ │ │    │
│  │                                          │ └────┬────┘ │ │    │
│  │                                          │      ↓      │ │    │
│  │                                          │ ┌─────────┐ │ │    │
│  │                                          │ │LLM 분석 │ │ │    │
│  │                                          │ │   ●     │ │ │    │
│  │                                          │ └─────────┘ │ │    │
│  │                                          └─────────────┘ │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 🤖 LLM 에러 수정                                         │    │
│  │ ┌─────────────────────────────────────────────────────┐ │    │
│  │ │ 빌드 시도: 2/5                                      │ │    │
│  │ │ 발견된 에러: 3개                                    │ │    │
│  │ │                                                     │ │    │
│  │ │ ✓ NullPointerException (UserService.java:45)       │ │    │
│  │ │ ● IllegalArgumentException (OrderService.java:78)  │ │    │
│  │ │ ○ TypeMismatch (PaymentService.java:120)           │ │    │
│  │ │                                                     │ │    │
│  │ │ LLM 응답 대기 중...                                 │ │    │
│  │ └─────────────────────────────────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 기능 정의

### 3.1 실행 전

| ID | 기능 | 설명 |
|----|------|------|
| F030-01 | 프로젝트 선택 | 드롭다운에서 프로젝트 선택 |
| F030-02 | 프로젝트 정보 표시 | 선택된 프로젝트 요약 정보 |
| F030-03 | 단계 선택 | 실행할 단계 체크박스 선택 |
| F030-04 | LLM 설정 | 사용할 LLM 모델 선택 |
| F030-05 | 반복 횟수 설정 | 빌드 실패 시 최대 반복 횟수 |
| F030-06 | 실행 시작 | 마이그레이션 실행 시작 |

### 3.2 실행 중

| ID | 기능 | 설명 |
|----|------|------|
| F030-07 | 상태 표시 | 실행 상태 및 경과 시간 |
| F030-08 | 워크플로우 시각화 | ReactFlow 기반 단계 표시 |
| F030-09 | 단계별 상태 | 각 단계 완료/진행/대기/실패 표시 |
| F030-10 | 실시간 로그 | SSE 기반 로그 스트리밍 |
| F030-11 | Auto-scroll | 로그 자동 스크롤 토글 |
| F030-12 | 로그 복사 | 전체 로그 클립보드 복사 |
| F030-13 | 실행 중지 | 실행 취소 (확인 필요) |

### 3.3 BUILD_LLM 단계

| ID | 기능 | 설명 |
|----|------|------|
| F030-14 | 반복 현황 | 현재 반복 횟수 / 최대 횟수 |
| F030-15 | 에러 목록 | 발견된 빌드 에러 목록 |
| F030-16 | 에러 수정 상태 | 각 에러별 수정 진행 상태 |
| F030-17 | LLM 응답 표시 | LLM 분석/수정 결과 표시 |

---

## 4. 워크플로우 단계

| 단계 | 코드 | 설명 | 예상 시간 |
|------|------|------|----------|
| Step 0 | SETUP_PROJECT | Git clone 또는 ZIP 압축 해제 | 30초~2분 |
| Step 1 | OPENREWRITE | Java/Spring 버전 변환 레시피 | 1~5분 |
| Step 2 | SQL | SQL 문법 변환 | 30초~2분 |
| Step 3 | BUILD_LLM | 빌드 + LLM 에러 수정 | 2~15분 |

---

## 5. API 연동

### 5.1 실행 시작
```yaml
POST /api/v1/tr/projects/{id}/runs
Body:
  steps: string[] (["SETUP_PROJECT", "OPENREWRITE", "SQL", "BUILD_LLM"])
  llmProvider: string ("openai" | "claude")
  maxBuildRetries: number (1-10)
Response:
  201:
    runId: string
    status: "PENDING"
```

### 5.2 실행 상태 조회
```yaml
GET /api/v1/tr/runs/{runId}
Response:
  id: string
  projectId: string
  status: "PENDING" | "RUNNING" | "SUCCESS" | "FAILED" | "CANCELLED"
  currentStep: string
  steps: [{
    type: string
    status: string
    startedAt: datetime
    completedAt: datetime
    duration: number
  }]
  buildRetryCount: number
  startedAt: datetime
  completedAt: datetime
```

### 5.3 로그 스트리밍 (SSE)
```yaml
GET /api/v1/tr/runs/{runId}/logs
Headers:
  Accept: text/event-stream
Response:
  event: log
  data: {"timestamp": "...", "level": "INFO", "message": "..."}
```

### 5.4 실행 취소
```yaml
POST /api/v1/tr/runs/{runId}/cancel
Response:
  200:
    status: "CANCELLED"
```

---

## 6. 상태 관리

```typescript
interface ExecutionState {
  selectedProjectId: string | null;
  project: Project | null;
  options: {
    steps: string[];
    llmProvider: string;
    maxBuildRetries: number;
  };
  run: Run | null;
  logs: LogEntry[];
  isAutoScroll: boolean;
  isRunning: boolean;
  buildLlmState: {
    retryCount: number;
    maxRetries: number;
    errors: BuildError[];
    currentError: BuildError | null;
    llmResponse: string | null;
  };
}
```

---

## 7. 중지 확인 모달

```
┌─────────────────────────────────────┐
│ ⚠️ 실행 중지                         │
├─────────────────────────────────────┤
│                                     │
│ 마이그레이션 실행을 중지하시겠습니까? │
│                                     │
│ 현재까지의 변환 결과는 유지되지만,   │
│ 실행은 "취소됨" 상태로 기록됩니다.   │
│                                     │
├─────────────────────────────────────┤
│              [계속 실행]  [중지]     │
└─────────────────────────────────────┘
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0.0 | 2026-01-13 | 초기 작성 |
