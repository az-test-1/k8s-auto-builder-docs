# SCR-031: 실행 모니터링

> **Status**: Draft
> **Version**: 1.0.0
> **Last Updated**: 2026-01-13
> **Parent**: [PRD-010-Core-Migration](../prd/PRD-010-Core-Migration.md)

---

## 1. 개요

### 1.1 화면 정보
| 항목 | 내용 |
|------|------|
| 화면 ID | SCR-031 |
| 화면명 | 실행 모니터링 |
| URL | `/runs/{runId}` |
| 접근 권한 | USER, ADMIN, VIEWER |

### 1.2 목적
진행 중이거나 완료된 실행의 상세 상태와 로그를 확인합니다.

---

## 2. 화면 구성

### 2.1 와이어프레임

```
┌─────────────────────────────────────────────────────────────────┐
│ ← 실행 목록           Run #26                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📁 my-legacy-project                                    │    │
│  │                                                         │    │
│  │ ┌───────────┐  ┌───────────────────────────────────┐    │    │
│  │ │ ✓ 성공    │  │ 시작: 2026-01-13 10:30:00        │    │    │
│  │ │           │  │ 종료: 2026-01-13 10:38:32        │    │    │
│  │ │  8분 32초 │  │ 빌드 반복: 2회                   │    │    │
│  │ └───────────┘  └───────────────────────────────────┘    │    │
│  │                                                         │    │
│  │ [📥 결과 다운로드]  [📋 로그 복사]  [🔄 재실행]          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ [단계별 상태]  [로그]  [변경 파일]  [에러 분석]           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ═══════════════════════════════════════════════════════════    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   단계별 실행 현황                        │    │
│  │                                                         │    │
│  │  ┌──────────────────────────────────────────────────┐   │    │
│  │  │ Step │ 단계명          │ 상태 │ 소요시간 │ 상세  │   │    │
│  │  ├──────────────────────────────────────────────────┤   │    │
│  │  │  0   │ SETUP_PROJECT   │  ✓   │  0:32   │  [>]  │   │    │
│  │  │  1   │ OPENREWRITE     │  ✓   │  2:15   │  [>]  │   │    │
│  │  │  2   │ SQL             │  ✓   │  1:08   │  [>]  │   │    │
│  │  │  3   │ BUILD_LLM       │  ✓   │  4:37   │  [>]  │   │    │
│  │  └──────────────────────────────────────────────────┘   │    │
│  │                                                         │    │
│  │  총 소요시간: 8분 32초                                   │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📊 BUILD_LLM 상세                                        │    │
│  │                                                         │    │
│  │  빌드 시도: 2회                                          │    │
│  │  ┌──────────────────────────────────────────────────┐   │    │
│  │  │ 시도 │ 결과 │ 에러 수 │ LLM 수정 │ 소요시간     │   │    │
│  │  ├──────────────────────────────────────────────────┤   │    │
│  │  │  1   │  ✗   │   5    │   5/5   │   2:15       │   │    │
│  │  │  2   │  ✓   │   0    │   -     │   2:22       │   │    │
│  │  └──────────────────────────────────────────────────┘   │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 로그 탭

```
┌─────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ [단계별 상태]  [로그]  [변경 파일]  [에러 분석]           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ═══════════════════════════════════════════════════════════    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 필터: [전체 ▼]  [INFO ▼]  검색: [____________] [🔍]     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ [10:30:00] [INFO]  실행 시작: Run #26                   │    │
│  │ [10:30:01] [INFO]  Step 0: SETUP_PROJECT 시작           │    │
│  │ [10:30:02] [INFO]  Git clone 시작: github.com/org/repo  │    │
│  │ [10:30:30] [INFO]  Git clone 완료                       │    │
│  │ [10:30:32] [INFO]  Step 0: SETUP_PROJECT 완료 (32초)    │    │
│  │ [10:30:33] [INFO]  Step 1: OPENREWRITE 시작             │    │
│  │ [10:30:35] [INFO]  레시피 로딩: java-17-migration       │    │
│  │ [10:31:00] [INFO]  파일 변환 중: 125개 파일             │    │
│  │ [10:32:45] [INFO]  변환 완료: 45개 파일 수정            │    │
│  │ [10:32:48] [INFO]  Step 1: OPENREWRITE 완료 (2분 15초)  │    │
│  │ ...                                                     │    │
│  │ [10:35:20] [WARN]  빌드 실패: 5개 에러 발견             │    │
│  │ [10:35:21] [INFO]  LLM 에러 분석 시작                   │    │
│  │ [10:35:45] [INFO]  에러 수정 완료: UserService.java     │    │
│  │ ...                                                     │    │
│  │ [10:38:30] [INFO]  빌드 성공                            │    │
│  │ [10:38:32] [INFO]  실행 완료: 성공                      │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 변경 파일 탭

```
┌─────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ [단계별 상태]  [로그]  [변경 파일]  [에러 분석]           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ═══════════════════════════════════════════════════════════    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 변경된 파일: 52개                          [diff 다운로드]│    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📂 src/main/java/com/example/                           │    │
│  │   ├─ 📄 UserService.java          [M] +15 -8   [diff]   │    │
│  │   ├─ 📄 OrderService.java         [M] +22 -12  [diff]   │    │
│  │   └─ 📄 PaymentService.java       [M] +8 -3    [diff]   │    │
│  │ 📂 src/main/resources/                                  │    │
│  │   ├─ 📄 application.yml           [M] +5 -2    [diff]   │    │
│  │   └─ 📂 mapper/                                         │    │
│  │       ├─ 📄 UserMapper.xml        [M] +3 -1    [diff]   │    │
│  │       └─ 📄 OrderMapper.xml       [M] +2 -1    [diff]   │    │
│  │ 📄 pom.xml                        [M] +25 -18  [diff]   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📄 UserService.java                                     │    │
│  │ ┌─────────────────────────────────────────────────────┐ │    │
│  │ │  45 │ -  @Autowired                                 │ │    │
│  │ │  45 │ +  @RequiredArgsConstructor                   │ │    │
│  │ │  46 │ -  private UserRepository userRepository;     │ │    │
│  │ │  46 │ +  private final UserRepository userRepository│ │    │
│  │ │     │                                               │ │    │
│  │ │  78 │ -  Date date = new Date();                    │ │    │
│  │ │  78 │ +  LocalDateTime date = LocalDateTime.now();  │ │    │
│  │ └─────────────────────────────────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 기능 정의

### 3.1 헤더 영역

| ID | 기능 | 설명 |
|----|------|------|
| F031-01 | 실행 정보 표시 | 프로젝트명, 상태, 시간 정보 |
| F031-02 | 결과 다운로드 | 변환된 소스 ZIP 다운로드 |
| F031-03 | 로그 복사 | 전체 로그 클립보드 복사 |
| F031-04 | 재실행 | 동일 설정으로 새 실행 시작 |

### 3.2 단계별 상태 탭

| ID | 기능 | 설명 |
|----|------|------|
| F031-05 | 단계 목록 | 각 단계별 상태, 소요시간 표시 |
| F031-06 | 단계 상세 | 단계 클릭 시 상세 정보 표시 |
| F031-07 | BUILD_LLM 상세 | 빌드 시도별 결과 표시 |

### 3.3 로그 탭

| ID | 기능 | 설명 |
|----|------|------|
| F031-08 | 전체 로그 | 실행 전체 로그 표시 |
| F031-09 | 단계별 필터 | 특정 단계 로그만 필터 |
| F031-10 | 레벨 필터 | INFO/WARN/ERROR 필터 |
| F031-11 | 검색 | 로그 내 텍스트 검색 |
| F031-12 | 실시간 업데이트 | 실행 중일 때 SSE 로그 추가 |

### 3.4 변경 파일 탭

| ID | 기능 | 설명 |
|----|------|------|
| F031-13 | 파일 트리 | 변경된 파일 트리 구조 |
| F031-14 | 변경 통계 | 추가/삭제 라인 수 |
| F031-15 | diff 보기 | 파일별 변경 내용 diff |
| F031-16 | diff 다운로드 | 전체 diff 파일 다운로드 |

### 3.5 에러 분석 탭

| ID | 기능 | 설명 |
|----|------|------|
| F031-17 | 에러 목록 | 발생한 에러 목록 |
| F031-18 | LLM 수정 내용 | 각 에러별 LLM 수정 내용 |
| F031-19 | 원본/수정 비교 | 수정 전/후 코드 비교 |

---

## 4. API 연동

### 4.1 실행 상세 조회
```yaml
GET /api/v1/tr/runs/{runId}
Response:
  id: string
  projectId: string
  projectName: string
  status: string
  startedAt: datetime
  completedAt: datetime
  duration: number
  buildRetryCount: number
  steps: [{
    type: string
    status: string
    startedAt: datetime
    completedAt: datetime
    duration: number
  }]
```

### 4.2 로그 조회
```yaml
GET /api/v1/tr/runs/{runId}/logs
Query:
  step: string (optional)
  level: string (optional)
  search: string (optional)
Response:
  logs: [{
    timestamp: datetime
    level: string
    step: string
    message: string
  }]
```

### 4.3 변경 파일 목록
```yaml
GET /api/v1/tr/runs/{runId}/changes
Response:
  totalFiles: number
  files: [{
    path: string
    status: "ADDED" | "MODIFIED" | "DELETED"
    additions: number
    deletions: number
  }]
```

### 4.4 파일 diff 조회
```yaml
GET /api/v1/tr/runs/{runId}/changes/{filePath}/diff
Response:
  originalContent: string
  modifiedContent: string
  diff: string (unified diff format)
```

### 4.5 결과 다운로드
```yaml
GET /api/v1/tr/runs/{runId}/download
Response:
  Content-Type: application/zip
  Content-Disposition: attachment; filename="project-migrated.zip"
```

---

## 5. 상태별 표시

| 상태 | 아이콘 | 색상 | 액션 |
|------|--------|------|------|
| PENDING | ○ | Gray | - |
| RUNNING | ● | Blue (pulse) | 중지 버튼 |
| SUCCESS | ✓ | Green | 다운로드, 재실행 |
| FAILED | ✗ | Red | 재실행 |
| CANCELLED | ⊘ | Yellow | 재실행 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0.0 | 2026-01-13 | 초기 작성 |
