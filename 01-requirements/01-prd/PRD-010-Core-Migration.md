# PRD-010: Core Migration

> **Status**: Draft
> **Version**: 1.0.0
> **Last Updated**: 2026-01-13
> **Owner**: Backend Team
> **Parent**: [PRD-000-MASTER](./PRD-000-MASTER.md)

---

## 1. 개요

### 1.1 목적
Auto-Builder의 핵심 마이그레이션 기능을 정의합니다.

### 1.2 범위
- 프로젝트 관리 (F1)
- 마이그레이션 실행 (F2)
- 실행 모니터링 (F3)
- 결과 관리 (F4)

---

## 2. 기능 요구사항

### 2.1 프로젝트 관리 (F1)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F1.1 | 프로젝트 생성 | Git URL 또는 ZIP 업로드로 프로젝트 등록 | P0 |
| F1.2 | 프로젝트 설정 | 타겟 Java/Spring 버전, 빌드 도구 설정 | P0 |
| F1.3 | 프로젝트 목록 | 등록된 프로젝트 조회/검색/필터 | P0 |
| F1.4 | 그룹 관리 | 프로젝트 그룹화 및 권한 관리 | P1 |

#### 프로젝트 데이터 모델
| 필드 | 타입 | 필수 | 설명 |
|------|------|:----:|------|
| id | UUID | Y | 고유 ID |
| group_id | UUID | N | 소속 그룹 |
| name | String | Y | 프로젝트 이름 |
| source_type | Enum | Y | GIT, ZIP |
| git_url | String | N | Git 저장소 URL |
| build_tool | Enum | Y | MAVEN, GRADLE |
| java_version | String | Y | 타겟 Java 버전 |
| spring_version | String | N | 타겟 Spring Boot 버전 |
| created_at | DateTime | Y | 생성 시간 |

### 2.2 마이그레이션 실행 (F2)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F2.1 | 워크플로우 실행 | 설정된 단계(Step) 순차 실행 | P0 |
| F2.2 | OpenRewrite 적용 | Java/Spring 버전 업그레이드 레시피 실행 | P0 |
| F2.3 | LLM 빌드 수정 | 빌드 에러 분석 및 자동 코드 수정 | P0 |
| F2.4 | 반복 빌드 | 에러 수정 후 재빌드 (최대 N회 반복) | P0 |

#### 마이그레이션 파이프라인

```
┌──────────────────────────────────────────────────────────────────┐
│                    마이그레이션 파이프라인                         │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  [Step 0]        [Step 1]         [Step 2]        [Step 3]       │
│  SETUP_PROJECT → OPENREWRITE  →   SQL        →   BUILD_LLM      │
│                                                                  │
│  ┌──────────┐   ┌──────────────┐  ┌─────────┐   ┌─────────────┐  │
│  │Git Clone │   │ Java 8→17   │  │ SQL문법 │   │ Maven/Gradle│  │
│  │  또는    │ → │ Spring 2→3  │→ │  변환   │ → │   빌드      │  │
│  │ZIP 압축해제│   │ (OpenRewrite)│  │         │   │ + LLM 수정  │  │
│  └──────────┘   └──────────────┘  └─────────┘   └─────────────┘  │
│                                                                  │
│                                        ↓ (빌드 실패시)            │
│                                   ┌─────────────┐                │
│                                   │ LLM 에러분석│                │
│                                   │ 코드 수정   │                │
│                                   │ 재빌드 반복 │                │
│                                   └─────────────┘                │
└──────────────────────────────────────────────────────────────────┘
```

#### 실행(Run) 데이터 모델
| 필드 | 타입 | 필수 | 설명 |
|------|------|:----:|------|
| id | UUID | Y | 고유 ID |
| project_id | UUID | Y | 프로젝트 ID |
| status | Enum | Y | PENDING, RUNNING, SUCCESS, FAILED, CANCELLED |
| started_at | DateTime | N | 시작 시간 |
| completed_at | DateTime | N | 완료 시간 |
| error_message | Text | N | 에러 메시지 |

#### 실행 단계(RunStep) 데이터 모델
| 필드 | 타입 | 필수 | 설명 |
|------|------|:----:|------|
| id | UUID | Y | 고유 ID |
| run_id | UUID | Y | 실행 ID |
| step_type | Enum | Y | SETUP_PROJECT, OPENREWRITE, SQL, BUILD_LLM |
| status | Enum | Y | PENDING, RUNNING, SUCCESS, FAILED, SKIPPED |
| started_at | DateTime | N | 시작 시간 |
| completed_at | DateTime | N | 완료 시간 |
| log_output | Text | N | 로그 출력 |

### 2.3 실행 모니터링 (F3)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F3.1 | 실시간 상태 | 각 단계별 진행 상태 실시간 표시 | P0 |
| F3.2 | 로그 스트리밍 | SSE 기반 실시간 로그 출력 | P0 |
| F3.3 | 시각적 플로우 | ReactFlow 기반 실행 단계 시각화 | P1 |
| F3.4 | 실행 이력 | 과거 실행 내역 조회 및 비교 | P1 |

### 2.4 결과 관리 (F4)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|:--------:|
| F4.1 | 변환 코드 다운로드 | 마이그레이션된 소스 ZIP 다운로드 | P0 |
| F4.2 | 변경 내역 조회 | 수정된 파일 목록 및 diff 확인 | P1 |
| F4.3 | 에러 리포트 | 실패 시 에러 원인 상세 리포트 | P0 |

---

## 3. API 명세

### 3.1 프로젝트 API

```yaml
POST   /api/v1/tr/projects                 # 프로젝트 생성
GET    /api/v1/tr/projects                 # 프로젝트 목록 조회
GET    /api/v1/tr/projects/{id}            # 프로젝트 상세 조회
PUT    /api/v1/tr/projects/{id}            # 프로젝트 수정
DELETE /api/v1/tr/projects/{id}            # 프로젝트 삭제
POST   /api/v1/tr/projects/{id}/upload     # 소스 업로드
```

### 3.2 실행 API

```yaml
POST   /api/v1/tr/projects/{id}/runs       # 실행 시작
GET    /api/v1/tr/runs                     # 실행 목록 조회
GET    /api/v1/tr/runs/{id}                # 실행 상세 조회
GET    /api/v1/tr/runs/{id}/logs           # 로그 조회 (SSE)
POST   /api/v1/tr/runs/{id}/cancel         # 실행 취소
GET    /api/v1/tr/runs/{id}/download       # 결과 다운로드
```

### 3.3 응답 형식

```json
{
  "code": "0000",
  "message": "Success",
  "data": {
    "result": [...],
    "pagination": {
      "page": 0,
      "size": 10,
      "total": 100
    }
  }
}
```

---

## 4. UI/UX

### 4.1 실행 화면 와이어프레임

```
┌─────────────────────────────────────────────────────────────────┐
│  [프로젝트 선택 ▼]                              [실행] [중지]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                   실행 플로우 시각화                      │    │
│  │                                                         │    │
│  │   [SETUP]──→[REWRITE]──→[SQL]──→[BUILD_LLM]            │    │
│  │      ✓         ●         ○          ○                   │    │
│  │                                                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  버전 목록              │  실시간 로그                          │
│  ┌───────────────────┐  │  ┌─────────────────────────────────┐  │
│  │ v1 - 완료 ✓       │  │  │ [12:00:01] Step 1 started...    │  │
│  │ v2 - 실행중 ●     │  │  │ [12:00:02] Applying recipe...   │  │
│  │ v3 - 대기 ○       │  │  │ [12:00:15] Build started...     │  │
│  └───────────────────┘  │  │ [12:00:45] Error: NullPointer...│  │
│                         │  │ [12:00:46] LLM fixing...         │  │
│                         │  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| API 응답 시간 | < 500ms (95 percentile) |
| 동시 실행 프로젝트 | 최대 10개 |
| 단일 프로젝트 처리 시간 | < 30분 (중형 프로젝트 기준) |
| 로그 스트리밍 지연 | < 1초 |
| 최대 프로젝트 크기 | 1GB |

---

## 6. 제약사항

| 제약 | 설명 |
|------|------|
| 빌드 도구 | Maven/Gradle만 지원 (Ant 미지원) |
| Java 버전 | Java 8 → 11/17만 지원 |
| Spring 버전 | Spring Boot 2.x → 3.x만 지원 |
| 프로젝트 크기 | 최대 1GB 소스 코드 |

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2026-01-13 | - | 기존 PRD에서 분리 |
